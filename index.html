<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S·ªï tay c√¥ng vi·ªác - v1.18</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0068ff">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #0068ff; --bg: #f8fafc; }
        body { background-color: var(--bg); font-family: -apple-system, sans-serif; overflow-x: hidden; }
        
        /* Sidebar 80% screen */
        #sidebar { 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 1000; 
            width: 80%; 
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
        }
        #sidebar.hidden-menu { transform: translateX(-101%); }
        #overlay { transition: opacity 0.3s ease; z-index: 900; }
        
        .form-input { width: 100%; padding: 14px; border: 1px solid #e2e8f0; border-radius: 14px; outline: none; font-size: 15px; background: white; }
        .form-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,104,255,0.1); }
        
        .btn-main { background: var(--primary); color: white; font-weight: 800; padding: 16px; border-radius: 16px; width: 100%; transition: all 0.2s; shadow: 0 4px 12px rgba(0,104,255,0.2); }
        .btn-main:active { transform: scale(0.97); opacity: 0.9; }

        .report-card { background: white; border-radius: 20px; padding: 18px; margin-bottom: 12px; border-left: 6px solid var(--primary); box-shadow: 0 2px 6px rgba(0,0,0,0.03); }
        .loader { width: 20px; height: 20px; border: 3px solid #fff; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg) } 100% { transform: rotate(360deg) } }
    </style>
</head>
<body class="antialiased">

    <div id="loadingOverlay" class="fixed inset-0 bg-white z-[2000] flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-gray-500 font-bold tracking-widest text-xs uppercase">ƒêang t·∫£i h·ªá th·ªëng...</p>
    </div>

    <div id="overlay" class="hidden fixed inset-0 bg-black/60 opacity-0 pointer-events-none transition-opacity"></div>

    <div id="sidebar" class="hidden-menu bg-white shadow-2xl flex flex-col overflow-hidden">
        <div class="p-6 bg-blue-600 text-white flex justify-between items-start">
            <div>
                <div class="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center text-2xl mb-3 shadow-inner">üë§</div>
                <div id="uNameSide" class="font-black text-xl leading-tight">ƒêang t·∫£i...</div>
                <div id="uRoleSide" class="text-xs text-blue-100 mt-1 opacity-80 uppercase tracking-tighter">...</div>
            </div>
            <button onclick="toggleSidebar()" class="w-10 h-10 flex items-center justify-center bg-black/10 rounded-full text-xl font-bold active:bg-black/20">‚úï</button>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <button onclick="showPage('reportForm')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-700 transition">
                <span class="mr-3 text-lg">‚úçÔ∏è</span> G·ª≠i b√°o c√°o
            </button>
            <button onclick="showPage('assignedTasks')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-700 transition">
                <span class="mr-3 text-lg">üìã</span> Vi·ªác ƒë∆∞·ª£c giao
            </button>
            <button onclick="showPage('history')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-700 transition">
                <span class="mr-3 text-lg">üïí</span> Nh·∫≠t k√Ω c·ªßa t√¥i
            </button>
            <div class="border-t my-4 opacity-50"></div>
            <button onclick="document.getElementById('profileModal').classList.remove('hidden')" class="w-full flex items-center p-4 hover:bg-blue-50 rounded-2xl font-bold text-gray-700 transition">
                <span class="mr-3 text-lg">‚öôÔ∏è</span> H·ªì s∆° c√° nh√¢n
            </button>
        </nav>
        
        <div class="p-4 border-t bg-gray-50">
            <button onclick="window.logout()" class="w-full p-4 text-red-600 font-black text-center bg-white border border-red-100 rounded-2xl shadow-sm active:bg-red-50">THO√ÅT T√ÄI KHO·∫¢N</button>
        </div>
    </div>

    <div id="appScreen" class="hidden flex flex-col h-screen">
        <header class="bg-white border-b px-5 py-4 flex items-center justify-between sticky top-0 z-10 shadow-sm">
            <button onclick="toggleSidebar()" class="text-2xl p-1 bg-gray-50 rounded-xl w-10 h-10 flex items-center justify-center active:scale-90 transition">‚ò∞</button>
            <h1 class="font-black text-blue-700 text-sm uppercase tracking-widest">S·ªï tay c√¥ng vi·ªác</h1>
            <div class="w-10"></div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 no-scrollbar pb-20">
            <div id="page-reportForm" class="page-section">
                <form id="form" class="space-y-4">
                    <div>
                        <label class="text-[11px] font-black text-gray-400 ml-1 uppercase mb-1 block">1. Ch·ªçn lo·∫°i b√°o c√°o</label>
                        <select id="reportType" onchange="handleTypeChange()" class="form-input font-black text-blue-600 border-2 border-blue-50 shadow-sm">
                            <option value="assigned">üìù C√¥ng vi·ªác ƒë∆∞·ª£c giao</option>
                            <option value="urgent">‚ö†Ô∏è B√°o c√°o ƒë·ªôt xu·∫•t</option>
                            <option value="daily">üìÖ B√°o c√°o h√†ng ng√†y</option>
                        </select>
                    </div>

                    <div id="assignedFields" class="space-y-4 bg-blue-50/50 p-4 rounded-2xl border-2 border-blue-100">
                        <div>
                            <label class="text-[10px] font-black text-blue-500 ml-1 uppercase mb-1 block">Ch·ªçn vi·ªác t·ª´ l√£nh ƒë·∫°o</label>
                            <select id="taskSelect" class="form-input font-bold border-blue-200">
                                <option value="">-- Click ƒë·ªÉ ch·ªçn c√¥ng vi·ªác --</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-[10px] font-black text-blue-500 ml-1 uppercase mb-1 block">Ti·∫øn ƒë·ªô (%)</label>
                                <select id="progress" onchange="checkReason()" class="form-input font-bold border-blue-200">
                                    <option value="100%">Xong 100%</option>
                                    <option value="70%">ƒê·∫°t 70%</option>
                                    <option value="50%">ƒê·∫°t 50%</option>
                                    <option value="25%">ƒê·∫°t 25%</option>
                                </select>
                            </div>
                            <div id="reasonBox" class="hidden">
                                <label class="text-[10px] font-black text-red-500 ml-1 uppercase mb-1 block">L√Ω do ch∆∞a xong *</label>
                                <input id="reason" placeholder="N√™u l√Ω do..." class="form-input border-red-100 bg-red-50/30">
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <input id="pct" placeholder="S·ªë Phi·∫øu / L·ªánh (N·∫øu c√≥)" class="form-input shadow-sm">
                        <textarea id="content" rows="4" placeholder="N·ªôi dung c√¥ng vi·ªác th·ª±c hi·ªán c·ª• th·ªÉ..." required class="form-input shadow-sm"></textarea>
                    </div>

                    <div class="p-6 bg-white border-2 border-dashed border-gray-200 rounded-2xl text-center shadow-sm">
                        <div id="fileListPreview" class="flex flex-wrap gap-2 mb-3"></div>
                        <input type="file" id="fileIn" multiple class="hidden" accept="image/*">
                        <button type="button" onclick="document.getElementById('fileIn').click()" class="text-blue-600 font-black text-xs uppercase tracking-tighter bg-blue-50 px-5 py-3 rounded-xl active:bg-blue-100 transition">
                            üì∏ Ch·ª•p ·∫£nh / ƒê√≠nh k√®m file
                        </button>
                    </div>

                    <button type="submit" id="sBtn" class="btn-main mt-4">G·ª¨I B√ÅO C√ÅO NGAY</button>
                </form>
            </div>

            <div id="page-assignedTasks" class="page-section hidden"><div id="assignedList" class="space-y-3"></div></div>
            <div id="page-history" class="page-section hidden"><div id="list" class="space-y-4"></div></div>
        </main>
    </div>

    <script type="module">
        // [Ph·∫ßn import v√† config Firebase gi·ªØ nguy√™n nh∆∞ v1.17]
        
        // --- SIDEBAR LOGIC ---
        window.toggleSidebar = () => {
            const side = document.getElementById('sidebar');
            const over = document.getElementById('overlay');
            if (side.classList.contains('hidden-menu')) {
                side.classList.remove('hidden-menu');
                over.classList.remove('hidden');
                setTimeout(() => over.classList.add('opacity-100'), 10);
            } else {
                side.classList.add('hidden-menu');
                over.classList.remove('opacity-100');
                setTimeout(() => over.classList.add('hidden'), 300);
            }
        };
        document.getElementById('overlay').onclick = window.toggleSidebar;

        window.showPage = (id) => {
            document.querySelectorAll('.page-section').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-' + id).classList.remove('hidden');
            if(window.innerWidth < 1024) window.toggleSidebar();
            if(id === 'history') loadReports('today');
        };

        // --- FORM LOGIC ---
        window.handleTypeChange = () => {
            const type = document.getElementById('reportType').value;
            const assignedBox = document.getElementById('assignedFields');
            const contentArea = document.getElementById('content');
            
            if (type === 'assigned') {
                assignedBox.classList.remove('hidden');
                contentArea.placeholder = "Chi ti·∫øt c√°c c√¥ng vi·ªác ƒë√£ l√†m trong ph·∫ßn vi·ªác ƒë∆∞·ª£c giao...";
            } else {
                assignedBox.classList.add('hidden');
                contentArea.placeholder = type === 'urgent' ? "M√¥ t·∫£ t√¨nh hu·ªëng ƒë·ªôt xu·∫•t..." : "N·ªôi dung c√¥ng vi·ªác th·ª±c hi·ªán trong ng√†y...";
            }
        };

        window.checkReason = () => {
            const prog = document.getElementById('progress').value;
            const reasonBox = document.getElementById('reasonBox');
            const reasonInput = document.getElementById('reason');
            if (prog !== '100%') {
                reasonBox.classList.remove('hidden');
                reasonInput.required = true;
            } else {
                reasonBox.classList.add('hidden');
                reasonInput.required = false;
            }
        };

        // Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu cho Form
        document.addEventListener('DOMContentLoaded', () => {
            handleTypeChange();
        });

        // ... [C√°c h√†m uploadFiles, submitForm, loadReports k·∫ø th·ª´a t·ª´ v1.17] ...
    </script>
</body>
</html>
